import { useState, useEffect } from "react";
import { motion } from "framer-motion";

export default function App() {
  const [mode, setMode] = useState(null); // "water" or "help"
  const [plant, setPlant] = useState("");
  const [availablePlants, setAvailablePlants] = useState([]);
  const [result, setResult] = useState(null);
  const [loading, setLoading] = useState(false);

 
  const API_KEY = "sk-QaVy68e289b31be2b12144";

  // Fetch list of available plants on load
  useEffect(() => {
    const fetchPlants = async () => {
      try {
        const res = await fetch(
          `https://perenual.com/api/species-list?key=${API_KEY}`
        );
        const data = await res.json();
        const names = data.data
          .map((p) => p.common_name)
          .filter(Boolean)
          .slice(0, 30); // limit to 30 for performance
        setAvailablePlants(names);
      } catch (err) {
        console.error("Error fetching plant list:", err);
      }
    };
    fetchPlants();
  }, []);

  const fetchPlantInfo = async () => {
    if (!plant) {
      setResult("Please select a plant first!");
      return;
    }
    setLoading(true);
    setResult(null);

    try {
      const res = await fetch(
        `https://perenual.com/api/species-list?key=${API_KEY}&q=${plant}`
      );
      const data = await res.json();
      const plantData = data.data?.[0];

      if (!plantData) {
        setResult("No data found for this plant üå±");
        setLoading(false);
        return;
      }

      let message = `üåø Info for ${plantData.common_name || plant}:\n`;

      if (mode === "water") {
        message += `üíß Watering: ${
          plantData.watering || "Water moderately based on soil moisture."
        }\n`;
        message += `‚òÄÔ∏è Sunlight: ${
          plantData.sunlight || "Provide bright, indirect light."
        }\n`;
        message += `ü™¥ Soil: ${
          plantData.soil_type || "Use well-draining potting mix."
        }`;
      } else if (mode === "help") {
        message += `üå± Propagation: ${
          plantData.propagation ||
          "Try adjusting water, sunlight, or soil conditions."
        }\n`;
        message += `üå°Ô∏è Temperature: ${
          plantData.temperature || "Keep in moderate indoor temperatures."
        }\n`;
        message += `‚òÄÔ∏è Sunlight: ${
          plantData.sunlight || "Adjust lighting as needed."
        }\n`;
        message += `üíß Watering: ${
          plantData.watering || "Avoid overwatering; check soil moisture."
        }`;
      }

      setResult(message);
    } catch (err) {
      setResult("‚ö†Ô∏è Network error. Please check your connection.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={styles.container}>
      <h1 style={styles.title}>üå± Plant Care Assistant</h1>

      {/* Mode Buttons */}
      <div style={styles.buttonGroup}>
        <button style={styles.button} onClick={() => setMode("water")}>
          How much to water plants
        </button>
        <button style={styles.button} onClick={() => setMode("help")}>
          My plant isn‚Äôt doing well
        </button>
      </div>

      {/* Dropdown + Result */}
      {mode && (
        <div style={styles.card}>
          <select
            value={plant}
            onChange={(e) => setPlant(e.target.value)}
            style={styles.select}
          >
            <option value="">Select a plant...</option>
            {availablePlants.map((p, i) => (
              <option key={i} value={p}>
                {p}
              </option>
            ))}
          </select>

          <button style={styles.searchButton} onClick={fetchPlantInfo}>
            {loading ? "Loading..." : "Search"}
          </button>

          {result && <pre style={styles.result}>{result}</pre>}
        </div>
      )}

      {/* Animated flower border */}
      <div style={styles.flowerRow}>
        {Array.from({ length: 10 }).map((_, i) => (
          <motion.div
            key={i}
            initial={{ y: 20, opacity: 0 }}
            animate={{ y: 0, opacity: 1 }}
            transition={{ delay: i * 0.1, duration: 1 }}
            style={styles.flower}
          >
            üå∏
          </motion.div>
        ))}
      </div>
    </div>
  );
}

// Inline styles
const styles = {
  container: {
    minHeight: "100vh",
    backgroundColor: "#e8f5e9",
    display: "flex",
    flexDirection: "column",
    alignItems: "center",
    justifyContent: "center",
    padding: "2rem",
    position: "relative",
    fontFamily: "system-ui, sans-serif",
  },
  title: {
    fontSize: "2rem",
    fontWeight: "bold",
    marginBottom: "1.5rem",
  },
  buttonGroup: {
    display: "flex",
    gap: "1rem",
    marginBottom: "1.5rem",
    flexWrap: "wrap",
    justifyContent: "center",
  },
  button: {
    backgroundColor: "#4caf50",
    color: "white",
    border: "none",
    borderRadius: "8px",
    padding: "0.75rem 1.25rem",
    cursor: "pointer",
    fontSize: "1rem",
  },
  card: {
    width: "100%",
    maxWidth: "400px",
    backgroundColor: "white",
    border: "1px solid #ccc",
    borderRadius: "10px",
    padding: "1rem",
    boxShadow: "0 2px 5px rgba(0,0,0,0.1)",
    display: "flex",
    flexDirection: "column",
    gap: "0.75rem",
  },
  select: {
    padding: "0.5rem",
    fontSize: "1rem",
    borderRadius: "5px",
    border: "1px solid #ccc",
  },
  searchButton: {
    backgroundColor: "#81c784",
    color: "white",
    border: "none",
    borderRadius: "6px",
    padding: "0.5rem 1rem",
    cursor: "pointer",
  },
  result: {
    whiteSpace: "pre-wrap",
    marginTop: "1rem",
    fontSize: "1rem",
    color: "#333",
  },
  flowerRow: {
    position: "absolute",
    bottom: "10px",
    left: 0,
    width: "100%",
    display: "flex",
    justifyContent: "space-around",
    padding: "0 1rem",
  },
  flower: {
    fontSize: "1.5rem",
  },
};
